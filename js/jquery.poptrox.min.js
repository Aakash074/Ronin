!function(T){T.fn.poptrox_disableSelection=function(){return T(this).css("user-select","none").css("-khtml-user-select","none").css("-moz-user-select","none").css("-o-user-select","none").css("-webkit-user-select","none")},T.fn.poptrox=function(e){function r(){i=T(window).width(),s=T(window).height()+l.windowHeightPad;var e=Math.abs(a.width()-a.outerWidth()),o=Math.abs(a.height()-a.outerHeight()),t=(b.width(),b.height(),i-2*l.windowMargin-e),p=s-2*l.windowMargin-o;a.css("min-width",l.popupWidth).css("min-height",l.popupHeight),w.children().css("max-width",t).css("max-height",p)}if(0==this.length)return T(this);if(1<this.length){for(var o=0;o<this.length;o++)T(this[o]).poptrox(e);return T(this)}var i,s,a,l=T.extend({preload:!1,baseZIndex:1e3,fadeSpeed:300,overlayColor:"#000000",overlayOpacity:.6,overlayClass:"poptrox-overlay",windowMargin:50,windowHeightPad:0,selector:"a",caption:null,parent:"body",popupSpeed:300,popupWidth:200,popupHeight:100,popupIsFixed:!1,useBodyOverflow:!1,usePopupEasyClose:!0,usePopupForceClose:!1,usePopupLoader:!0,usePopupCloser:!0,usePopupCaption:!1,usePopupNav:!1,usePopupDefaultStyling:!0,popupBackgroundColor:"#FFFFFF",popupTextColor:"#000000",popupLoaderTextSize:"2em",popupCloserBackgroundColor:"#000000",popupCloserTextColor:"#FFFFFF",popupCloserTextSize:"20px",popupPadding:10,popupCaptionHeight:60,popupCaptionTextSize:null,popupBlankCaptionText:"",popupCloserText:"&#215;",popupLoaderText:"&bull;&bull;&bull;&bull;",popupClass:"poptrox-popup",popupSelector:null,popupLoaderSelector:".loader",popupCloserSelector:".closer",popupCaptionSelector:".caption",popupNavPreviousSelector:".nav-previous",popupNavNextSelector:".nav-next",onPopupClose:null,onPopupOpen:null},e),t=T(this),p=T("body"),n=T('<div class="'+l.overlayClass+'"></div>'),u=T(window),d=[],h=0,g=!1,f=new Array;l.usePopupLoader||(l.popupLoaderSelector=null),l.usePopupCloser||(l.popupCloserSelector=null),l.usePopupCaption||(l.popupCaptionSelector=null),l.usePopupNav||(l.popupNavPreviousSelector=null,l.popupNavNextSelector=null);var x,v,w=(a=T(l.popupSelector?l.popupSelector:'<div class="'+l.popupClass+'">'+(l.popupLoaderSelector?'<div class="loader">'+l.popupLoaderText+"</div>":"")+'<div class="pic"></div>'+(l.popupCaptionSelector?'<div class="caption"></div>':"")+(l.popupCloserSelector?'<span class="closer">'+l.popupCloserText+"</span>":"")+(l.popupNavPreviousSelector?'<div class="nav-previous"></div>':"")+(l.popupNavNextSelector?'<div class="nav-next"></div>':"")+"</div>")).find(".pic"),b=T(),m=a.find(l.popupLoaderSelector),C=a.find(l.popupCaptionSelector),y=a.find(l.popupCloserSelector),S=a.find(l.popupNavNextSelector),P=a.find(l.popupNavPreviousSelector),k=S.add(P);l.usePopupDefaultStyling&&(a.css("background",l.popupBackgroundColor).css("color",l.popupTextColor).css("padding",l.popupPadding+"px"),0<C.length&&(a.css("padding-bottom",l.popupCaptionHeight+"px"),C.css("position","absolute").css("left","0").css("bottom","0").css("width","100%").css("text-align","center").css("height",l.popupCaptionHeight+"px").css("line-height",l.popupCaptionHeight+"px"),l.popupCaptionTextSize&&C.css("font-size",popupCaptionTextSize)),0<y.length&&y.html(l.popupCloserText).css("font-size",l.popupCloserTextSize).css("background",l.popupCloserBackgroundColor).css("color",l.popupCloserTextColor).css("display","block").css("width","40px").css("height","40px").css("line-height","40px").css("text-align","center").css("position","absolute").css("text-decoration","none").css("outline","0").css("top","0").css("right","-40px"),0<m.length&&m.html("").css("position","relative").css("font-size",l.popupLoaderTextSize).on("startSpinning",function(e){var o=T("<div>"+l.popupLoaderText+"</div>");o.css("height",Math.floor(l.popupHeight/2)+"px").css("overflow","hidden").css("line-height",Math.floor(l.popupHeight/2)+"px").css("text-align","center").css("margin-top",Math.floor((a.height()-o.height()+(0<C.length?C.height():0))/2)).css("color",l.popupTextColor?l.popupTextColor:"").on("xfin",function(){o.fadeTo(300,.5,function(){o.trigger("xfout")})}).on("xfout",function(){o.fadeTo(300,.05,function(){o.trigger("xfin")})}).trigger("xfin"),m.append(o)}).on("stopSpinning",function(e){m.find("div").remove()}),2==k.length)&&(k.css("font-size","75px").css("text-align","center").css("color","#fff").css("text-shadow","none").css("height","100%").css("position","absolute").css("top","0").css("opacity","0.35").css("cursor","pointer").css("box-shadow","inset 0px 0px 10px 0px rgba(0,0,0,0)").poptrox_disableSelection(),l.usePopupEasyClose?v=x="100px":(x="75%",v="25%"),S.css("right","0").css("width",x).html('<div style="position: absolute; height: 100px; width: 125px; top: 50%; right: 0; margin-top: -50px;">&gt;</div>'),P.css("left","0").css("width",v).html('<div style="position: absolute; height: 100px; width: 125px; top: 50%; left: 0; margin-top: -50px;">&lt;</div>'));return u.on("resize orientationchange",function(){r()}),C.on("update",function(e,o){o&&0!=o.length||(o=l.popupBlankCaptionText),C.html(o)}),y.css("cursor","pointer").on("click",function(e){return e.preventDefault(),e.stopPropagation(),a.trigger("poptrox_close"),!0}),S.on("click",function(e){e.stopPropagation(),e.preventDefault(),a.trigger("poptrox_next")}),P.on("click",function(e){e.stopPropagation(),e.preventDefault(),a.trigger("poptrox_previous")}),n.css("position","fixed").css("left",0).css("top",0).css("z-index",l.baseZIndex).css("width","100%").css("height","100%").css("text-align","center").css("cursor","pointer").appendTo(l.parent).prepend('<div style="display:inline-block;height:100%;vertical-align:middle;"></div>').append('<div style="position:absolute;left:0;top:0;width:100%;height:100%;background:'+l.overlayColor+";opacity:"+l.overlayOpacity+";filter:alpha(opacity="+100*l.overlayOpacity+');"></div>').hide().on("touchmove",function(e){return!1}).on("click",function(e){e.preventDefault(),e.stopPropagation(),a.trigger("poptrox_close")}),a.css("display","inline-block").css("vertical-align","middle").css("position","relative").css("z-index",1).css("cursor","auto").appendTo(n).hide().on("poptrox_next",function(){var e=h+1;e>=d.length&&(e=0),a.trigger("poptrox_switch",[e])}).on("poptrox_previous",function(){var e=h-1;e<0&&(e=d.length-1),a.trigger("poptrox_switch",[e])}).on("poptrox_reset",function(){r(),a.data("width",l.popupWidth).data("height",l.popupHeight),m.hide().trigger("stopSpinning"),C.hide(),y.hide(),k.hide(),w.hide(),b.attr("src","").detach()}).on("poptrox_open",function(e,o){return!!g||(g=!0,l.useBodyOverflow&&p.css("overflow","hidden"),l.onPopupOpen&&l.onPopupOpen(),a.addClass("loading"),void n.fadeTo(l.fadeSpeed,1,function(){a.trigger("poptrox_switch",[o,!0])}))}).on("poptrox_switch",function(e,p,o){var i,t,s;if(!o&&g)return!0;(g=!0,a.addClass("loading").css("width",a.data("width")).css("height",a.data("height")),C.hide(),b.attr("src")&&b.attr("src",""),b.detach(),i=d[p],(b=i.object).off("load"),w.css("text-indent","-9999px").show().append(b),"ajax"==i.type?T.get(i.src,function(e){b.html(e),b.trigger("load")}):b.attr("src",i.src),"image"!=i.type)&&(t=i.width,s=i.height,"%"==t.slice(-1)&&(t=parseInt(t.substring(0,t.length-1))/100*u.width()),"%"==s.slice(-1)&&(s=parseInt(s.substring(0,s.length-1))/100*u.height()),b.css("position","relative").css("outline","0").css("z-index",l.baseZIndex+100).width(t).height(s));m.trigger("startSpinning").fadeIn(300),a.show(),l.popupIsFixed?(a.removeClass("loading").width(l.popupWidth).height(l.popupHeight),b.load(function(){b.off("load"),m.hide().trigger("stopSpinning"),C.trigger("update",[i.captionText]).fadeIn(l.fadeSpeed),y.fadeIn(l.fadeSpeed),w.css("text-indent",0).hide().fadeIn(l.fadeSpeed,function(){g=!1}),h=p,k.fadeIn(l.fadeSpeed)})):b.load(function(){r(),b.off("load"),m.hide().trigger("stopSpinning");var e=b.width(),o=b.height(),t=function(){C.trigger("update",[i.captionText]).fadeIn(l.fadeSpeed),y.fadeIn(l.fadeSpeed),w.css("text-indent",0).hide().fadeIn(l.fadeSpeed,function(){g=!1}),h=p,k.fadeIn(l.fadeSpeed),a.removeClass("loading").data("width",e).data("height",o).css("width","auto").css("height","auto")};e==a.data("width")&&o==a.data("height")?t():a.animate({width:e,height:o},l.popupSpeed,"swing",t)}),"image"!=i.type&&b.trigger("load")}).on("poptrox_close",function(){return!(!g||l.usePopupForceClose)||(g=!0,a.hide().trigger("poptrox_reset"),l.onPopupClose&&l.onPopupClose(),void n.fadeOut(l.fadeSpeed,function(){l.useBodyOverflow&&p.css("overflow","auto"),g=!1}))}).trigger("poptrox_reset"),l.usePopupEasyClose?(C.on("click","a",function(e){e.stopPropagation()}),a.css("cursor","pointer").on("click",function(e){e.stopPropagation(),e.preventDefault(),a.trigger("poptrox_close")})):a.on("click",function(e){e.stopPropagation()}),u.keydown(function(e){if(a.is(":visible"))switch(e.keyCode){case 37:case 32:if(l.usePopupNav)return a.trigger("poptrox_previous"),!1;break;case 39:if(l.usePopupNav)return a.trigger("poptrox_next"),!1;break;case 27:return a.trigger("poptrox_close"),!1}}),t.find(l.selector).each(function(o){var e,t=T(this),p=t.find("img"),i=t.data("poptrox");if("ignore"!=i&&t.attr("href")){if(e={src:t.attr("href"),captionText:p.attr("title"),width:null,height:null,type:null,object:null,options:null},l.caption){if("function"==typeof l.caption)c=l.caption(t);else if("selector"in l.caption){var s;s=t.find(l.caption.selector),"attribute"in l.caption?c=s.attr(l.caption.attribute):(c=s.html(),!0===l.caption.remove&&s.remove())}}else c=p.attr("title");if(e.captionText=c,i){var r=i.split(",");0 in r&&(e.type=r[0]),1 in r&&((n=r[1].match(/([0-9%]+)x([0-9%]+)/))&&3==n.length&&(e.width=n[1],e.height=n[2])),2 in r&&(e.options=r[2])}if(!e.type)switch(n=e.src.match(/\/\/([a-z0-9\.]+)\/.*/),(!n||n.length<2)&&(n=[!1]),n[1]){case"api.soundcloud.com":e.type="soundcloud";break;case"youtu.be":e.type="youtube";break;case"vimeo.com":e.type="vimeo";break;case"wistia.net":e.type="wistia";break;case"bcove.me":e.type="bcove";break;default:e.type="image"}switch(n=e.src.match(/\/\/[a-z0-9\.]+\/(.*)/),e.type){case"iframe":e.object=T('<iframe src="" frameborder="0"></iframe>'),e.object.on("click",function(e){e.stopPropagation()}).css("cursor","auto"),e.width&&e.height||(e.width="600",e.height="400");break;case"ajax":e.object=T('<div class="poptrox-ajax"></div>'),e.object.on("click",function(e){e.stopPropagation()}).css("cursor","auto").css("overflow","auto"),e.width&&e.height||(e.width="600",e.height="400");break;case"soundcloud":e.object=T('<iframe scrolling="no" frameborder="no" src=""></iframe>'),e.src="//w.soundcloud.com/player/?url="+escape(e.src)+(e.options?"&"+e.options:""),e.width="600",e.height="166";break;case"youtube":e.object=T('<iframe src="" frameborder="0" allowfullscreen="1"></iframe>'),e.src="//www.youtube.com/embed/"+n[1]+(e.options?"?"+e.options:""),e.width&&e.height||(e.width="800",e.height="480");break;case"vimeo":e.object=T('<iframe src="" frameborder="0" allowFullScreen="1"></iframe>'),e.src="//player.vimeo.com/video/"+n[1]+(e.options?"?"+e.options:""),e.width&&e.height||(e.width="800",e.height="480");break;case"wistia":e.object=T('<iframe src="" frameborder="0" allowFullScreen="1"></iframe>'),e.src="//fast.wistia.net/"+n[1]+(e.options?"?"+e.options:""),e.width&&e.height||(e.width="800",e.height="480");break;case"bcove":e.object=T('<iframe src="" frameborder="0" allowFullScreen="1" width="100%"></iframe>'),e.src="//bcove.me/"+n[1]+(e.options?"?"+e.options:""),e.width&&e.height||(e.width="640",e.height="360");break;default:var n;if(e.object=T('<img src="" alt="" style="vertical-align:bottom" />'),l.preload)(n=document.createElement("img")).src=e.src,f.push(n);e.width=t.attr("width"),e.height=t.attr("height")}"file:"==window.location.protocol&&e.src.match(/^\/\//)&&(e.src="http:"+e.src),d.push(e),p.removeAttr("title"),t.removeAttr("href").css("cursor","pointer").css("outline",0).on("click",function(e){e.preventDefault(),e.stopPropagation(),a.trigger("poptrox_open",[o])})}}),t.prop("_poptrox",l),t}}(jQuery);